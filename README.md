# 📖 wn_os AI API 价格透视镜 使用指南

## 🎛️ 顶部控制栏详解

控制栏位于页面最上方，决定了全站数据的展示维度。

### 1. 单位与货币

- **单位 (1K / 1M)**：切换价格显示单位。

  - `1K`：每 1,000 Tokens 的价格。

  - `1M`：每 1,000,000 Tokens 的价格（OneAPI 默认标准）。

- **货币 (倍率 / USD / CNY)**：

  - `倍率`：显示原始模型倍率（Ratio）。

  - `USD`：显示美元价格。对于按量计费模型，系统会自动应用 **(充值汇率/基准汇率)** 的折扣系数。

  - `CNY`：显示人民币价格。计算公式为 `USD价格 × 基准汇率`。

### 2. 交互模式

- **👁️ 仅查看**：点击模型旁边的 `☰` 菜单仅用于查看其他分组的价格，不会改变当前渠道的设置。

- **⚡ 点击切换**：点击 `☰` 菜单中的某个分组，**整个渠道** 会立即切换到该分组（例如从 Default 切到 VIP），方便全局对比。

### 3. 映射设置 (⚙️ 映射)

- 用于解决不同渠道模型命名不一致的问题。

- **操作**：点击按钮 -> 输入“原模型名”（如 `gpt-4-svip`）-> 输入“目标名”（如 `gpt-4`）-> 点击添加。

- **效果**：`gpt-4-svip` 会被自动归纳到 `gpt-4` 这一行进行比价，并在价格下方显示原名标签。

### 4. 基准汇率

- 输入当前真实的美元兑人民币汇率（如 `7.28`）。这会影响 CNY 模式下的最终换算。

---

## 📊 渠道配置与比价

### 1. 添加数据源

- 点击 **"+ 添加渠道"**。

- **粘贴数据**：在文本框中粘贴 OneAPI/NewAPI 导出的分组倍率 JSON（包含 `model_ratio` 或 `data` 数组的 JSON）。

- **充值汇率**：**这是比价的核心！**

  - 如果该站点是 1:1 充值（1元=1刀），填 `1`。

  - 如果该站点是 7.2 汇率充值，填 `7.2`。

  - _系统会自动计算折扣：如果基准是7.2，你填1，系统会判定该站价格为官方的 1/7.2。_

### 2. 渠道控制条

- **分组选择**：在渠道卡片底部中间，选择要查看的分组（如 `default`, `vip`）。

- **全部开关**：位于右下角。

  - 🔴 **关闭**：仅显示该分组实际拥有的模型。

  - 🟢 **开启**：显示该分组没有，但该渠道其他分组可能有的模型（显示为 `-` 和 `☰`）。

---

## 📉 核心比价逻辑与排序

### 1. 价格展示

- **按量计费 (Token)**：

  - 主行：输入价格 (In)。

  - 副行 (灰色小字)：输出价格 (Out)。

  - **绿色高亮**：表示该价格是当前行所有渠道中的**最低价**。

  - **折扣徽章**：如 `15%`，表示该价格是官方原价的 15%（超值）。

- **按次计费 (Quota=1)**：

  - 显示为 `xxx/次`。

  - **注意**：按次计费模型**不应用**站点的充值汇率折扣（视为绝对面值），且不参与“最低价标绿”竞争，也不显示折扣徽章。

### 2. 排序功能 (三态排序)

点击表头的排序按钮可循环切换：

- **模型名列**：

  1. `A→Z`：字母升序。

  2. `Z→A`：字母降序。

  3. `↕` (默认)：**官方基准顺序**（官方推荐的模型排前面，官方没有的排后面）。

- **渠道价格列**：

  1. `↑ 低→高`：按价格从便宜到贵排序。_(多变体时取该行最低价对比)_

  2. `↓ 高→低`：按价格从贵到便宜排序。_(多变体时取该行最高价对比)_

  3. `↕` (默认)：恢复默认模型名顺序。

> **排序优先级规则**：
>
> 1. **可用性**：当前分组有的模型永远排在前面。
>
> 2. **计费类型**：按量计费 (Token) 永远排在 按次计费 (Fixed) 前面。
>
> 3. **数值/名称**：最后才按价格或名称排序。

---

## 🔬 高级技巧：X-Ray 透视 (☰)

当你在模型价格旁边看到 `☰` 图标时，意味着该模型有“隐藏信息”。

1. **普通显示 (☰)**：当前分组有此模型，且其他分组也有。点击可对比不同分组价格。

2. **高亮脉冲 (☰ 闪烁)**：当前分组**没有**此模型（显示 `-`），但其他分组**有**。

   - _场景_：你在 Default 分组没找到 `gpt-4`，看到 `☰` 在闪，点击它并选择 VIP 分组，即可一键切换过去使用。

---
🚀 运行方式
本项目支持轻量级本地运行或通过 Docker 容器部署，请根据需求选择：

1. 本地运行 (Local)
   最简单的运行方式，无需安装任何环境。

   操作：直接下载项目中的 index.html 文件。

   运行：双击文件或将其拖入浏览器（如 Chrome、Edge）即可直接使用完整功能。

2. Docker 部署

   如果你希望在服务器上托管或通过容器运行，可以使用官方镜像。

   镜像名称：wnos/ai-api-price-transparency:v0.1

---

## ❓ 常见问题

**Q: 为什么有的模型显示价格为 0？** A: 请检查是否选择了“倍率”模式，且该模型倍率确实为0。如果是按次计费模型，请确认 JSON 中包含 `model_price` 字段。

**Q: 为什么按次计费的模型没有标绿？** A: 按次计费模型的定价逻辑通常比较特殊（一口价），为了避免误导（例如 $0.01/次 和 $0.5/1M tokens 无法直接对比），v5.1 版本后移除了按次模型的比价高亮。

**Q: 为什么我看不到某些模型？** A: 请检查渠道底部的“全部”开关是否关闭。如果关闭，且当前分组没有该模型，它会被隐藏。或者检查顶部的搜索框是否残留了关键词。
